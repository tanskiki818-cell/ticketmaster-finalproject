{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Favourite Events</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>


<nav class="navbar navbar-expand-lg bg-dark border-bottom border-body fixed-top" data-bs-theme="dark">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link active">{{ user.username }}</a>
          </li>
          <li class="nav-item">
            <a href="{% url 'logout' %}" class="btn btn-light ms-3 mb-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
              </svg> logout
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'ticketmaster' %}" class="btn btn-light ms-3 mb-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   class="bi bi-house-door" viewBox="0 0 16 16">
                <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z"/>
              </svg> Home
            </a>
          </li>
        {% endif %}
        <li class="nav-item">
          <button id="dark-mode-btn" class="btn btn-secondary mb-3 mx-3">Dark Mode</button>
        </li>
      </ul>
    </div>
  </div>
</nav>




<div class="container" >
<div>
    <h2 class="mb-4 text-center text-primary fs-1" style="padding-top:90px;" >Your Favourite Events</h2>
    
    <button id="switch_viewMode" class="mb-3 btn btn-outline-success ms-3 ">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar2-range" viewBox="0 0 16 16">
        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z"/>
         <path d="M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5zM9 8a1 1 0 0 1 1-1h5v2h-5a1 1 0 0 1-1-1m-8 2h4a1 1 0 1 1 0 2H1z"/>
        </svg> Switch View <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-spreadsheet" viewBox="0 0 16 16">
         <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v4h10V2a1 1 0 0 0-1-1zm9 6h-3v2h3zm0 3h-3v2h3zm0 3h-3v2h2a1 1 0 0 0 1-1zm-4 2v-2H6v2zm-4 0v-2H3v1a1 1 0 0 0 1 1zm-2-3h2v-2H3zm0-3h2V7H3zm3-2v2h3V7zm3 3H6v2h3z"/>
        </svg> </button>
    
    <form action="{% url 'display_favourite' %}" method="get">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Search event name" name="search-term"
                           aria-label="Search Term" aria-describedby="button-addon2">
                    <button class="btn btn-primary" type="submit" id="button-addon2"><i class="fas fa-search"></i> Search</button>
                    <a href="{% url 'display_favourite' %}" class="btn btn-secondary ms-2"><i class="fas fa-undo"></i> Reset</a>
                </div>
            </form>
    
   

</div>

    {% if favourites %}
    <div class="row g-3 align-items-stretch d-none" id="cardView"> 
        {% for event in favourites %}
            
       <div class="col-lg-4 col-md-6 col-sm-12 event-card" id="event-{{ event.id }}" >
        <div class="card h-100 shadow-lg bg-body-tertiary rounded">
        <img src="{{ event.images_url }}" class="card-img-top img-fluid" alt="{{ event.name }}">
        <div class="card-body d-flex flex-column">
           <p class="fw-bold text-dark fs-5 editable" id="name-{{ event.id }}">{{ event.name }}</p> 
            <p>{{ event.venue }} in {{ event.city }}, {{ event.state }}</p> 
            <p>{{ event.date }} {{ event.time }}</p>

        <div class="mt-auto">
             <a href="{{ event.url }}" target="_blank" class="btn btn-primary btn-sm mt-1">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
</svg>View</a>
           
             <button onclick="deleteEvent('{{ event.id }}')" class="btn btn-danger btn-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
</svg> Delete with ajax</button>
        </div>
           
        </div>
    </div>
</div>
        {% endfor %}
    </div>
        

<div id="tableView" class="row g-3 align-items-stretch">
    <div class="col-12">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>#</th>
                <th>Event</th>
                <th>Image</th>
                <th>Venue</th>
                <th>Date</th>
                <th>Time</th>
                <th>View</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
        </thead>

        <tbody>
        
            {% for event in favourites %}
            <tr id="event-{{ event.id }}">
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{ event.name }}</td>
                
                <td>
                    <img style="width: 120px" class="img-fluid img-thumbnail"
                         src="{{ event.images_url }}" alt="{{ event.name }}">
                </td>
                <td>{{ event.venue }} ({{ event.city }}, {{ event.state }})</td>
                <td>{{ event.date }}</td>
                <td>{{ event.time }}</td>
                <td>
                    <a href="{{ event.url }}" target="_blank" class="text-primary"><i class="fa-solid fa-eye"></i></a></td>
                <td>
                    
                    <a href="{% url 'update_favourite' event.id %}" class="text-warning">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </a>
                </td>

               
                <td>
                    <a href="{% url 'delete_favourite' event.id %}" class="text-danger">
                        <i class="fa-solid fa-trash"></i>
                    </a>
                   
                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
</div>
</div>
        
    {% else %}
    <p>No favorites yet.</p>
    {% endif %}

    </div> 

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'js/favouriteScript.js' %}"></script>
<script src="{% static 'js/script.js' %}"></script>

<script>
    
function deleteEvent(eventId){
    $.ajax({
        url: '{% url "delete_event_with_ajax" %}',
        type: 'POST',
        data: {
            event_id : eventId,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (response){
            console.log(response);
            if(response.deleted){
                $('#event-'+eventId).remove();
            }
        }
    });
}




</script>

</body>
</html>
