{% load static %}

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Ticketmaster Search</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<nav class="navbar navbar-expand-lg bg-dark border-bottom border-body fixed-top" data-bs-theme="dark">
  <div class="container">

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

        {% if user.is_authenticated %}
          <li class="nav-item">
            <span class="nav-link active">{{ user.username }}</span>
          </li>
          <li class="nav-item">
            <a href="{% url 'logout' %}" class="btn btn-light btn-sm ms-2 mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                   class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
              </svg> logout
            </a>
          </li>
        {% else %}
          <li class="nav-item">
            <a href="{% url 'login' %}" class="nav-link btn btn-light btn-sm ms-2">login</a>
          </li>
          <li class="nav-item">
            <a href="{% url 'register' %}" class="nav-link btn btn-light btn-sm ms-2">register</a>
          </li>
        {% endif %}

        <li class="nav-item">
          <button id="dark-mode-btn" class="btn btn-secondary btn-sm ms-2">Dark Mode</button>
        </li>

      </ul>
    </div>

  </div>
</nav>



<div style="margin-top: 55px;"></div>

<div class="container-fluid py-5 bg-dark text-center text-white">
    <h1 class="display-4">Ticketmaster</h1>
    <h2 class="mb-3"><b>Quickly find tickets around you</b></h2>


    <a href="{% url 'display_favourite' %}" class="btn btn-outline-warning ms-3 mb-3">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
  <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
</svg> View Favourites
</a>



    <div class="row justify-content-center w-100">
        <div class="col-md-6 col-12">

            <form method="get">
                <div class="input-group">
                    <input class="form-control" list="datalistOptions"  placeholder="Type to search by genre" name="genre" value="{{ genre }}">
                    <datalist id="datalistOptions">
                        <option value="Music">
                        <option value="Sports">
                        <option value="Theater">
                        <option value="Family">
                        <option value="Arts & Theater">
                        <option value="Concerts">
                        <option value="Comedy">
                        <option value="Dance">
                    </datalist>
                    <input type="text" name="city" class="form-control" placeholder="Enter a city e.g., Hartford" value="{{ city }}">
                    <button class="btn btn-primary" type="submit">Search</button>
                </div>
            </form>
        </div>
    </div>

    {% if error %}
      <div class="alert alert-danger w-50 mx-auto my-3 text-start">{{ error }}</div>
    {% endif %}
</div>

<div class="container-fluid my-4 d-flex justify-content-center">
    <div class="col-12 col-md-10">
        <div class="p-5 shadow-lg {% if not request.GET or error%}d-none{% endif %}" id="event-container">

         {% if not events and request.GET %}
             <div class="fs-5">{{ message }}</div>
         {% endif %}

            {% if events %}
                <div class="text-secondary fs-3 mb-3"><b>{{ events|length }} events found</b></div>
                {% for event in events %}
                <div class="card mb-3 shadow-lg">
                    <div class="row g-0 align-items-center">
                        <div class="col-md-4 col-sm-12">
                            {% if event.images %}
                            <img src="{{ event.images_url }}" class="img-fluid rounded card-img-top my-3" alt="{{ event.name }}">
                            {% endif %}
                        </div>
                        <div class="col-md-4 col-6">
                            <div class="card-body">
                                <h3 class="card-title"><b>{{ event.name }}</b></h3>
                                <div class="card-text mt-4 text-secondary">
                                    <p class="fs-5 d-inline">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/></svg>
                                        {{ event.venue_name }}
                                    </p><br>
                                    {{ event.address }}<br>
                                    <span class="fs-6">{{ event.city }}, {{ event.state }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 text-end px-3 pb-5">
                            {% if event.date %}
                            <h5 class="text-muted mb-2 text-primary-emphasis">{{ event.date}} <br>{{ event.time }}</h5>
                            {% endif %}
                            <a href="{{ event.url }}" class="btn btn-outline-primary mt-2">  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-ticket-detailed" viewBox="0 0 16 16">
                            <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M5 7a1 1 0 0 0 0 2h6a1 1 0 1 0 0-2z"/>
                            <path d="M0 4.5A1.5 1.5 0 0 1 1.5 3h13A1.5 1.5 0 0 1 16 4.5V6a.5.5 0 0 1-.5.5 1.5 1.5 0 0 0 0 3 .5.5 0 0 1 .5.5v1.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 11.5V10a.5.5 0 0 1 .5-.5 1.5 1.5 0 1 0 0-3A.5.5 0 0 1 0 6zM1.5 4a.5.5 0 0 0-.5.5v1.05a2.5 2.5 0 0 1 0 4.9v1.05a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-1.05a2.5 2.5 0 0 1 0-4.9V4.5a.5.5 0 0 0-.5-.5z"/>
                            </svg> Find Tickets</a><br>

                        {% if user.is_authenticated %}
                            {% if event.check_favourite %}
                                <p class="text-danger mx-5 fs-2"><i class="fa-solid fa-heart"></i></p>
                                {% else %}
                                <button class="add_fav btn btn-outline-danger mt-3"
                                data-event-name="{{ event.name }}"
                                data-venue-name="{{ event.venue_name }}"
                                data-city="{{ event.city }}"
                                data-state="{{ event.state }}"
                                data-event-date="{{ event.date }}"
                                data-event-time="{{ event.time }}"
                                data-images-url="{{ event.images_url }}"
                                data-event-url="{{ event.url }}">
                                        Add to favourites
                            </button>

                            {% endif %}
                        {% endif %}


                        </div>
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/script.js' %}"></script>
<script>

   $('.add_fav').click(function() {
    const $btn = $(this);
    $.ajax({
        url: '/ticketmaster/add_favourite/',
        type: 'POST',
        data: {
            event_name: $btn.data('event-name'),
            venue_name: $btn.data('venue-name'),
            city: $btn.data('city'),
            state: $btn.data('state'),
            event_date: $btn.data('event-date'),
            event_time: $btn.data('event-time'),
            images_url: $btn.data('images-url'),
            event_url: $btn.data('event-url'),
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function(result) {
            if (result.added === "success") {
                $btn.html('<i class="fa-solid fa-heart"></i>');
            } else {
                alert(result.message);
            }
        }
    });
});



</script>

</body>
</html>
